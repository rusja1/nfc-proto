<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NFC Demo</title>
<style>
  body {
    margin:0;
    font-family: system-ui, -apple-system, sans-serif;
    background: #0b0b0c;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    text-align: center;
    flex-direction: column;
  }
  h1 {
    font-size: 2rem;
    margin-bottom: 1rem;
  }
  img {
    width: 150px;
    height: 150px;
    object-fit: contain;
    margin-bottom: 1rem;
  }
  .muted {
    color: #aaa;
    font-size: 1rem;
  }
  button {
    background: #1a1a1d;
    border: 1px solid #2a2a2e;
    color: #fff;
    border-radius: 10px;
    padding: 0.7rem 1rem;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 2rem;
  }
</style>
</head>
<body>

  <div id="content">
    <h1>Scan an NFC tag</h1>
    <p class="muted">Tap your Apple or Carrot tag</p>
    <button id="scanBtn">Scan (Android)</button>
  </div>

  <script>
    // Tag mapping
    const MAP = {
      "FRUIT_APPLE_01": {
        name: "Apple",
        img: "https://upload.wikimedia.org/wikipedia/commons/1/15/Red_Apple.jpg"
      },
      "VEG_CARROT_07": {
        name: "Carrot",
        img: "https://images.pexels.com/photos/143133/pexels-photo-143133.jpeg?_gl=1*f07jf2*_ga*ODU4Nzc1MDg5LjE3MzA3MzAwMTg.*_ga_8JE65Q40S6*czE3NjA4MjA5MzUkbzM1JGcxJHQxNzYwODIwOTUyJGo0MyRsMCRoMA.."
      }
    };

    const content = document.getElementById('content');

    function showItem(tag) {
      const item = MAP[tag];
      if (item) {
        content.innerHTML = `
          <h1>${item.name}</h1>
          <img src="${item.img}" alt="${item.name}">
          <p>You just scanned <strong>${item.name}</strong>.</p>
        `;
      } else {
        content.innerHTML = `<h1>Unknown tag</h1><p class="muted">${tag}</p>`;
      }
    }

    // Read tag ID from URL (iPhone)
    const params = new URLSearchParams(location.search);
    const tagParam = params.get('tag');
    if (tagParam) showItem(tagParam);

    // NFC Scan (Android)
    const scanBtn = document.getElementById('scanBtn');
    scanBtn.addEventListener('click', async () => {
      if (!('NDEFReader' in window)) {
        alert('Web NFC not supported on this device/browser.');
        return;
      }
      try {
        const reader = new NDEFReader();
        await reader.scan();
        reader.onreading = event => {
          let text = '';
          for (const record of event.message.records) {
            const decoder = new TextDecoder(record.encoding || "utf-8");
            text = decoder.decode(record.data);
          }
          showItem(text);
        };
      } catch (err) {
        alert('NFC scan failed: ' + err);
      }
    });
  </script>
</body>
</html>

